<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>3.2.1.1.3.1. Creating a Task</title><link rel="stylesheet" href="Common_Content/css/default.css" type="text/css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 2.5" /><meta name="package" content="Beaker-Deployment_Guide-0.5-en-US-1-9" /><link rel="home" href="index.html" title="Deployment Guide" /><link rel="up" href="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks.html" title="3.2.1.1.3. Tasks" /><link rel="prev" href="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks.html" title="3.2.1.1.3. Tasks" /><link rel="next" href="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Task_Searching.html" title="3.2.1.1.3.2. Task Searching" /></head><body><p id="title"><a class="left" href="https://fedorahosted.org/publican"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="https://fedorahosted.org/publican"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Task_Searching.html"><strong>Next</strong></a></li></ul><div class="section" id="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Creating_a_Task"><div class="titlepage"><div><div><h6 class="title" id="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Creating_a_Task">3.2.1.1.3.1. Creating a Task</h6></div></div></div><div class="para">
				To create Tasks the <span class="application"><strong>rhts-devel</strong></span> package will need to be installed. From your terminal, type:
			</div><pre class="screen">$ yum install rhts-devel</pre><div class="para">
				Now make a new directory from where you will create the test. Then <span class="application"><strong>cd</strong></span> into the newly created folder and run the following:
			</div><pre class="screen">$ rhts-create-new-test
$ ls -l
Makefile  PURPOSE  runtest.sh
</pre><div class="para">
				Below is a rundown of the files created and how to use them
			</div><div class="section" id="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Creating_a_Task-runtest_sh"><div class="titlepage"><div><div><h6 class="title" id="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Creating_a_Task-runtest_sh">3.2.1.1.3.1.1. runtest.sh</h6></div></div></div><div class="para">
					The core of each Beaker test is a <span class="application"><strong>runtest.sh</strong></span> shell script. It performs the testing (or delegates the work by invoking another script or executable) and reports the results. Either write the code that performs the test in the <span class="application"><strong>runtest.sh</strong></span> shell script or have runtest.sh execute another program that does the bulk of the work in perhaps another language. Choose a language appropriate to the job (and with which you are familiar): testing of a library could be written in C, parsing of text streams could be done in Perl, and GUI scripting in Python. Languages can be mixed and matched as appropriate within a single test - the <span class="application"><strong>runtest.sh</strong></span> script can call other code as necessary. Aim for correctness and readability: remember that others may have to debug this code if a test is flawed. Here is the example<span class="application"><strong> runtest.sh</strong></span>:
				</div><pre class="screen">#!/bin/sh
# Copyright (c) 2006  All rights reserved. This copyrighted
# material  is made available to anyone wishing to use, modify, copy, or
# redistribute it subject to the terms and conditions of the GNU General
# Public License v.2.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software Foundation, Inc., 
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301,USA.

# Author: Your Name &lt;Your Email&gt;</pre><div class="para">
					The do-my-test.sh is a rather simple test, seen below, just enough to illustrate the required components of a task.
				</div><pre class="screen">#!/bin/sh
# simple test example

ls -al /root/.ssh</pre><div class="para">
					The exit code from listing the contents of<span class="application"><strong> /root/.ssh</strong></span> will be saved to the <span class="application"><strong>$?</strong></span> system variable and based on this,<span class="application"><strong> rhts-run-simple-test </strong></span>will report the failure or success of the Task. So the most basic Beaker coding requirements are that a shell script must be sourced <span class="application"><strong>(rhts-environment.sh)</strong></span> and the report_result API must be called (this is called in <span class="application"><strong>rhts-run-simple-test</strong></span>).The output was sent to <span class="application"><strong>$OUTPUTFILE </strong></span>(in <span class="application"><strong>rhts-environment.sh</strong></span>). The Beaker API provides the <span class="application"><strong>$OUTPUTFILE</strong></span> variable so each test can create a log file to record its activities. When run from the command line, <span class="application"><strong>$OUTPUTFILE</strong></span> points to a temporary file in<span class="application"><strong> /tmp</strong></span>. When run in a test lab environment, the logs are stored in a central location. The report_result method is always called to inform the Beaker API of the success or failure of the test.
				</div></div><div class="section" id="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Creating_a_Task-Makefile"><div class="titlepage"><div><div><h6 class="title" id="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Creating_a_Task-Makefile">3.2.1.1.3.1.2. Makefile </h6></div></div></div><div class="para">
					A standard Beaker Makefile coordinates many aspects of developing and running a Beaker test: 
					<div class="itemizedlist"><ul><li class="listitem"><div class="para">
								compiling test executables.
							</div></li><li class="listitem"><div class="para">
								packaging test files into a single RPM.
							</div></li><li class="listitem"><div class="para">
								downloading external source files for use in the test.
							</div></li><li class="listitem"><div class="para">
								collect test files into a known location for execution.
							</div></li><li class="listitem"><div class="para">
								running tests
							</div></li></ul></div>

				</div><div class="para">
					A sample Makefile is copied into the local directory when rhts-create-new-test tool is invoked (or can be found a<span class="application"><strong>t /usr/share/doc/rhts-devel-2.6/Makefile.template</strong></span>). The Makefile sets up certain targets and defines variables necessary for test execution and reporting. It is best to use this example when writing a new test, copying and modifying it as necessary. So for example, in order to have an executable compiled by the Makefile, the following two lines were changed.
				</div><pre class="screen">
                    BUILT_FILES=do-my-test
                    FILES=$(METADATA) runtest.sh Makefile PURPOSE do-my-test.c
</pre><div class="para">
					When <span class="application"><strong>make run</strong></span> is typed, the Makefile will compile<span class="application"><strong> do-my-test.cintodo-my-test</strong></span> and run runtest.sh, which will then execute <span class="application"><strong>do-my-test</strong></span>. You do not have to enter anything in the <span class="application"><strong>BUILT_FILES</strong></span> directive if you are not compiling an executable. Also be sure to fill in the following section:
				</div><pre class="screen"># The toplevel namespace within which the test lives.
# FIXME: You will need to change this:
TOPLEVEL_NAMESPACE=

# The name of the package under test:
# FIXME: you wil need to change this:
PACKAGE_NAME=

# The path of the test below the package:
# FIXME: you wil need to change this:
RELATIVE_PATH=</pre><div class="para">
					Those three place holders will be used to determine how your Task is named in Beaker, and also how it's mounted on a test System. It will be called /<span class="application"><strong>TOPLEVEL_NAMESPACE/PACKAGE_NAME/RELATIVE_PATH</strong></span> and it will be mounted the same in the <span class="application"><strong>/mnt/tests</strong></span> directory on a test System.
				</div></div><div class="section" id="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Creating_a_Task-Purpose"><div class="titlepage"><div><div><h6 class="title" id="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Creating_a_Task-Purpose">3.2.1.1.3.1.3. PURPOSE</h6></div></div></div><div class="para">
					The test code directory contains a plain text file called<span class="application"><strong>PURPOSE</strong></span> which explains what the test addresses along with any other information useful for troubleshooting or understanding it better. The <span class="application"><strong>PURPOSE</strong></span> file has no minimum or maximum length but should provide useful information. For example:
				</div><pre class="screen">$ cat PURPOSE
This trivial test compiles a .c file, runs the resulting code, and checks
that the output is as expected.

It is intended as a simple example of how to write a test that
compiles source code to a binary and reports a single result
using rhts-run-simple-test

It can also be used as a primitive smoketest for the compiler.</pre></div><div class="section" id="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Creating_a_Task-Packaging"><div class="titlepage"><div><div><h6 class="title" id="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Creating_a_Task-Packaging">3.2.1.1.3.1.4. Packaging</h6></div></div></div><div class="para">
					Before we can add a new Task to Beaker we need to package it. Firstly, you're able to run the task locally (if it makes sense) to ensure that the task operates as expected. If you would like to run the task locally:
				</div><pre class="screen">
<span class="application"><strong>$ make run</strong></span>
chmod a+x ./runtest.sh
./runtest.sh
/tmp/simple_test/do-my-test.sh
Running ./do-my-test.sh  As root: 
total 48
drwx------  2 root root  4096 Dec 15 08:41 .
drwxr-x--- 24 root root 12288 Jun  2 14:57 ..
-rw-------  1 root root   415 Dec 13 19:12 authorized_keys
-rw-r--r--  1 root root  8630 May 25 09:42 known_hosts
...finished running ./do-my-test.sh, exit code=0
/// result: PASS
   Log: /tmp/tmp.c24401</pre><div class="para">
					Once you're happy it works as expected, you can run the following:
				</div><div class="note"><div class="admonition_header"><h2>Tagging</h2></div><div class="admonition"><div class="para">
						If you wish to, and your Task is revisioned with git or CVS, you can increase the version of the package with the following command:
					</div><div class="para">
						$ make tag
					</div></div></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks.html"><strong>Prev</strong>3.2.1.1.3. Tasks</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="User_Guide-Getting_Started-Process-Beaker_Interface-Tasks-Task_Searching.html"><strong>Next</strong>3.2.1.1.3.2. Task Searching</a></li></ul></body></html>
