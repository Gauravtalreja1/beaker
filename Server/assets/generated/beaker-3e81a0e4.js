!function($){"use strict";$(function(){$.support.transition=function(){var transitionEnd=function(){var el=document.createElement("bootstrap"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},name;for(name in transEndEventNames){if(el.style[name]!==undefined){return transEndEventNames[name]}}}();return transitionEnd&&{end:transitionEnd}}()})}(window.jQuery);!function($){"use strict";var Modal=function(element,options){this.options=options;this.$element=$(element).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};Modal.prototype={constructor:Modal,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var that=this,e=$.Event("show");this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;this.isShown=true;this.escape();this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");if(!that.$element.parent().length){that.$element.appendTo(document.body)}that.$element.show();if(transition){that.$element[0].offsetWidth}that.$element.addClass("in").attr("aria-hidden",false);that.enforceFocus();transition?that.$element.one($.support.transition.end,function(){that.$element.focus().trigger("shown")}):that.$element.focus().trigger("shown")})},hide:function(e){e&&e.preventDefault();var that=this;e=$.Event("hide");this.$element.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;this.escape();$(document).off("focusin.modal");this.$element.removeClass("in").attr("aria-hidden",true);$.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var that=this;$(document).on("focusin.modal",function(e){if(that.$element[0]!==e.target&&!that.$element.has(e.target).length){that.$element.focus()}})},escape:function(){var that=this;if(this.isShown&&this.options.keyboard){this.$element.on("keyup.dismiss.modal",function(e){e.which==27&&that.hide()})}else if(!this.isShown){this.$element.off("keyup.dismiss.modal")}},hideWithTransition:function(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end);that.hideModal()},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout);that.hideModal()})},hideModal:function(){var that=this;this.$element.hide();this.backdrop(function(){that.removeBackdrop();that.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(callback){var that=this,animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body);this.$backdrop.click(this.options.backdrop=="static"?$.proxy(this.$element[0].focus,this.$element[0]):$.proxy(this.hide,this));if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");if(!callback)return;doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one($.support.transition.end,callback):callback()}else if(callback){callback()}}};var old=$.fn.modal;$.fn.modal=function(option){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),typeof option=="object"&&option);if(!data)$this.data("modal",data=new Modal(this,options));if(typeof option=="string")data[option]();else if(options.show)data.show()})};$.fn.modal.defaults={backdrop:true,keyboard:true,show:true};$.fn.modal.Constructor=Modal;$.fn.modal.noConflict=function(){$.fn.modal=old;return this};$(document).on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault();$target.modal(option).one("hide",function(){$this.focus()})})}(window.jQuery);!function($){"use strict";var toggle="[data-toggle=dropdown]",Dropdown=function(element){var $el=$(element).on("click.dropdown.data-api",this.toggle);$("html").on("click.dropdown.data-api",function(){$el.parent().removeClass("open")})};Dropdown.prototype={constructor:Dropdown,toggle:function(e){var $this=$(this),$parent,isActive;if($this.is(".disabled, :disabled"))return;$parent=getParent($this);isActive=$parent.hasClass("open");clearMenus();if(!isActive){if("ontouchstart"in document.documentElement){$('<div class="dropdown-backdrop"/>').insertBefore($(this)).on("click",clearMenus)}$parent.toggleClass("open")}$this.focus();return false},keydown:function(e){var $this,$items,$active,$parent,isActive,index;if(!/(38|40|27)/.test(e.keyCode))return;$this=$(this);e.preventDefault();e.stopPropagation();if($this.is(".disabled, :disabled"))return;$parent=getParent($this);isActive=$parent.hasClass("open");if(!isActive||isActive&&e.keyCode==27){if(e.which==27)$parent.find(toggle).focus();return $this.click()}$items=$("[role=menu] li:not(.divider):visible a",$parent);if(!$items.length)return;index=$items.index($items.filter(":focus"));if(e.keyCode==38&&index>0)index--;if(e.keyCode==40&&index<$items.length-1)index++;if(!~index)index=0;$items.eq(index).focus()}};function clearMenus(){$(".dropdown-backdrop").remove();$(toggle).each(function(){getParent($(this)).removeClass("open")})}function getParent($this){var selector=$this.attr("data-target"),$parent;if(!selector){selector=$this.attr("href");selector=selector&&/#/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,"")}$parent=selector&&$(selector);if(!$parent||!$parent.length)$parent=$this.parent();return $parent}var old=$.fn.dropdown;$.fn.dropdown=function(option){return this.each(function(){var $this=$(this),data=$this.data("dropdown");if(!data)$this.data("dropdown",data=new Dropdown(this));if(typeof option=="string")data[option].call($this)})};$.fn.dropdown.Constructor=Dropdown;$.fn.dropdown.noConflict=function(){$.fn.dropdown=old;return this};$(document).on("click.dropdown.data-api",clearMenus).on("click.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.dropdown.data-api",toggle+", [role=menu]",Dropdown.prototype.keydown)}(window.jQuery);!function($){"use strict";var Tab=function(element){this.element=$(element)};Tab.prototype={constructor:Tab,show:function(){var $this=this.element,$ul=$this.closest("ul:not(.dropdown-menu)"),selector=$this.attr("data-target"),previous,$target,e;if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}if($this.parent("li").hasClass("active"))return;previous=$ul.find(".active:last a")[0];e=$.Event("show",{relatedTarget:previous});$this.trigger(e);if(e.isDefaultPrevented())return;$target=$(selector);this.activate($this.parent("li"),$ul);this.activate($target,$target.parent(),function(){$this.trigger({type:"shown",relatedTarget:previous})})},activate:function(element,container,callback){var $active=container.find("> .active"),transition=callback&&$.support.transition&&$active.hasClass("fade");function next(){$active.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");element.addClass("active");if(transition){element[0].offsetWidth;element.addClass("in")}else{element.removeClass("fade")}if(element.parent(".dropdown-menu")){element.closest("li.dropdown").addClass("active")}callback&&callback()}transition?$active.one($.support.transition.end,next):next();$active.removeClass("in")}};var old=$.fn.tab;$.fn.tab=function(option){return this.each(function(){var $this=$(this),data=$this.data("tab");if(!data)$this.data("tab",data=new Tab(this));if(typeof option=="string")data[option]()})};$.fn.tab.Constructor=Tab;$.fn.tab.noConflict=function(){$.fn.tab=old;return this};$(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault();$(this).tab("show")})}(window.jQuery);!function($){"use strict";var dismiss='[data-dismiss="alert"]',Alert=function(el){$(el).on("click",dismiss,this.close)};Alert.prototype.close=function(e){var $this=$(this),selector=$this.attr("data-target"),$parent;if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}$parent=$(selector);e&&e.preventDefault();$parent.length||($parent=$this.hasClass("alert")?$this:$this.parent());$parent.trigger(e=$.Event("close"));if(e.isDefaultPrevented())return;$parent.removeClass("in");function removeElement(){$parent.trigger("closed").remove()}$.support.transition&&$parent.hasClass("fade")?$parent.on($.support.transition.end,removeElement):removeElement()};var old=$.fn.alert;$.fn.alert=function(option){return this.each(function(){var $this=$(this),data=$this.data("alert");if(!data)$this.data("alert",data=new Alert(this));if(typeof option=="string")data[option].call($this)})};$.fn.alert.Constructor=Alert;$.fn.alert.noConflict=function(){$.fn.alert=old;return this};$(document).on("click.alert.data-api",dismiss,Alert.prototype.close)}(window.jQuery);!function($){"use strict";var Button=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.button.defaults,options)};Button.prototype.setState=function(state){var d="disabled",$el=this.$element,data=$el.data(),val=$el.is("input")?"val":"html";state=state+"Text";data.resetText||$el.data("resetText",$el[val]());$el[val](data[state]||this.options[state]);setTimeout(function(){state=="loadingText"?$el.addClass(d).attr(d,d):$el.removeClass(d).removeAttr(d)},0)};Button.prototype.toggle=function(){var $parent=this.$element.closest('[data-toggle="buttons-radio"]');$parent&&$parent.find(".active").removeClass("active");this.$element.toggleClass("active")};var old=$.fn.button;$.fn.button=function(option){return this.each(function(){var $this=$(this),data=$this.data("button"),options=typeof option=="object"&&option;if(!data)$this.data("button",data=new Button(this,options));if(option=="toggle")data.toggle();else if(option)data.setState(option)})};$.fn.button.defaults={loadingText:"loading..."};$.fn.button.Constructor=Button;$.fn.button.noConflict=function(){$.fn.button=old;return this};$(document).on("click.button.data-api","[data-toggle^=button]",function(e){var $btn=$(e.target);if(!$btn.hasClass("btn"))$btn=$btn.closest(".btn");$btn.button("toggle")})}(window.jQuery);!function($){"use strict";var Collapse=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.collapse.defaults,options);if(this.options.parent){this.$parent=$(this.options.parent)}this.options.toggle&&this.toggle()};Collapse.prototype={constructor:Collapse,dimension:function(){var hasWidth=this.$element.hasClass("width");return hasWidth?"width":"height"},show:function(){var dimension,scroll,actives,hasData;if(this.transitioning||this.$element.hasClass("in"))return;dimension=this.dimension();scroll=$.camelCase(["scroll",dimension].join("-"));actives=this.$parent&&this.$parent.find("> .accordion-group > .in");if(actives&&actives.length){hasData=actives.data("collapse");if(hasData&&hasData.transitioning)return;actives.collapse("hide");hasData||actives.data("collapse",null)}this.$element[dimension](0);this.transition("addClass",$.Event("show"),"shown");$.support.transition&&this.$element[dimension](this.$element[0][scroll])},hide:function(){var dimension;if(this.transitioning||!this.$element.hasClass("in"))return;dimension=this.dimension();this.reset(this.$element[dimension]());this.transition("removeClass",$.Event("hide"),"hidden");this.$element[dimension](0)},reset:function(size){var dimension=this.dimension();this.$element.removeClass("collapse")[dimension](size||"auto")[0].offsetWidth;this.$element[size!==null?"addClass":"removeClass"]("collapse");return this},transition:function(method,startEvent,completeEvent){var that=this,complete=function(){if(startEvent.type=="show")that.reset();that.transitioning=0;that.$element.trigger(completeEvent)};this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;this.transitioning=1;this.$element[method]("in");$.support.transition&&this.$element.hasClass("collapse")?this.$element.one($.support.transition.end,complete):complete()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var old=$.fn.collapse;$.fn.collapse=function(option){return this.each(function(){var $this=$(this),data=$this.data("collapse"),options=$.extend({},$.fn.collapse.defaults,$this.data(),typeof option=="object"&&option);if(!data)$this.data("collapse",data=new Collapse(this,options));if(typeof option=="string")data[option]()})};$.fn.collapse.defaults={toggle:true};$.fn.collapse.Constructor=Collapse;$.fn.collapse.noConflict=function(){$.fn.collapse=old;return this};$(document).on("click.collapse.data-api","[data-toggle=collapse]",function(e){var $this=$(this),href,target=$this.attr("data-target")||e.preventDefault()||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,""),option=$(target).data("collapse")?"toggle":$this.data();$this[$(target).hasClass("in")?"addClass":"removeClass"]("collapsed");$(target).collapse(option)})}(window.jQuery);(function($){var VERSION="0.9.3";var utils={isMsie:function(){var match=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return match?parseInt(match[2],10):false},isBlankString:function(str){return!str||/^\s*$/.test(str)},escapeRegExChars:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(obj){return typeof obj==="string"},isNumber:function(obj){return typeof obj==="number"},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(obj){return typeof obj==="undefined"},bind:$.proxy,bindAll:function(obj){var val;for(var key in obj){$.isFunction(val=obj[key])&&(obj[key]=$.proxy(val,obj))}},indexOf:function(haystack,needle){for(var i=0;i<haystack.length;i++){if(haystack[i]===needle){return i}}return-1},each:$.each,map:$.map,filter:$.grep,every:function(obj,test){var result=true;if(!obj){return result}$.each(obj,function(key,val){if(!(result=test.call(null,val,key,obj))){return false}});return!!result},some:function(obj,test){var result=false;if(!obj){return result}$.each(obj,function(key,val){if(result=test.call(null,val,key,obj)){return false}});return!!result},mixin:$.extend,getUniqueId:function(){var counter=0;return function(){return counter++}}(),defer:function(fn){setTimeout(fn,0)},debounce:function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later,callNow;later=function(){timeout=null;if(!immediate){result=func.apply(context,args)}};callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args)}return result}},throttle:function(func,wait){var context,args,timeout,result,previous,later;previous=0;later=function(){previous=new Date;timeout=null;result=func.apply(context,args)};return function(){var now=new Date,remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}return result}},tokenizeQuery:function(str){return $.trim(str).toLowerCase().split(/[\s]+/)},tokenizeText:function(str){return $.trim(str).toLowerCase().split(/[\s\-_]+/)},getProtocol:function(){return location.protocol},noop:function(){}};var EventTarget=function(){var eventSplitter=/\s+/;return{on:function(events,callback){var event;if(!callback){return this}this._callbacks=this._callbacks||{};events=events.split(eventSplitter);while(event=events.shift()){this._callbacks[event]=this._callbacks[event]||[];this._callbacks[event].push(callback)}return this},trigger:function(events,data){var event,callbacks;if(!this._callbacks){return this}events=events.split(eventSplitter);while(event=events.shift()){if(callbacks=this._callbacks[event]){for(var i=0;i<callbacks.length;i+=1){callbacks[i].call(this,{type:event,data:data})}}}return this}}}();var EventBus=function(){var namespace="typeahead:";function EventBus(o){if(!o||!o.el){$.error("EventBus initialized without el")}this.$el=$(o.el)}utils.mixin(EventBus.prototype,{trigger:function(type){var args=[].slice.call(arguments,1);this.$el.trigger(namespace+type,args)}});return EventBus}();var PersistentStorage=function(){var ls,methods;try{ls=window.localStorage;ls.setItem("~~~","!");ls.removeItem("~~~")}catch(err){ls=null}function PersistentStorage(namespace){this.prefix=["__",namespace,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+this.prefix)}if(ls&&window.JSON){methods={_prefix:function(key){return this.prefix+key},_ttlKey:function(key){return this._prefix(key)+this.ttlKey},get:function(key){if(this.isExpired(key)){this.remove(key)}return decode(ls.getItem(this._prefix(key)))},set:function(key,val,ttl){if(utils.isNumber(ttl)){ls.setItem(this._ttlKey(key),encode(now()+ttl))}else{ls.removeItem(this._ttlKey(key))}return ls.setItem(this._prefix(key),encode(val))},remove:function(key){ls.removeItem(this._ttlKey(key));ls.removeItem(this._prefix(key));return this},clear:function(){var i,key,keys=[],len=ls.length;for(i=0;i<len;i++){if((key=ls.key(i)).match(this.keyMatcher)){keys.push(key.replace(this.keyMatcher,""))}}for(i=keys.length;i--;){this.remove(keys[i])}return this},isExpired:function(key){var ttl=decode(ls.getItem(this._ttlKey(key)));return utils.isNumber(ttl)&&now()>ttl?true:false}}}else{methods={get:utils.noop,set:utils.noop,remove:utils.noop,clear:utils.noop,isExpired:utils.noop}}utils.mixin(PersistentStorage.prototype,methods);return PersistentStorage;function now(){return(new Date).getTime()}function encode(val){return JSON.stringify(utils.isUndefined(val)?null:val)}function decode(val){return JSON.parse(val)}}();var RequestCache=function(){function RequestCache(o){utils.bindAll(this);o=o||{};this.sizeLimit=o.sizeLimit||10;this.cache={};this.cachedKeysByAge=[]}utils.mixin(RequestCache.prototype,{get:function(url){return this.cache[url]},set:function(url,resp){var requestToEvict;if(this.cachedKeysByAge.length===this.sizeLimit){requestToEvict=this.cachedKeysByAge.shift();delete this.cache[requestToEvict]}this.cache[url]=resp;this.cachedKeysByAge.push(url)}});return RequestCache}();var Transport=function(){var pendingRequestsCount=0,pendingRequests={},maxPendingRequests,requestCache;function Transport(o){utils.bindAll(this);o=utils.isString(o)?{url:o}:o;requestCache=requestCache||new RequestCache;maxPendingRequests=utils.isNumber(o.maxParallelRequests)?o.maxParallelRequests:maxPendingRequests||6;this.url=o.url;this.wildcard=o.wildcard||"%QUERY";this.filter=o.filter;this.replace=o.replace;this.ajaxSettings={type:"get",cache:o.cache,timeout:o.timeout,dataType:o.dataType||"json",beforeSend:o.beforeSend};this._get=(/^throttle$/i.test(o.rateLimitFn)?utils.throttle:utils.debounce)(this._get,o.rateLimitWait||300)}utils.mixin(Transport.prototype,{_get:function(url,cb){var that=this;if(belowPendingRequestsThreshold()){this._sendRequest(url).done(done)}else{this.onDeckRequestArgs=[].slice.call(arguments,0)}function done(resp){var data=that.filter?that.filter(resp):resp;cb&&cb(data);requestCache.set(url,resp)}},_sendRequest:function(url){var that=this,jqXhr=pendingRequests[url];if(!jqXhr){incrementPendingRequests();jqXhr=pendingRequests[url]=$.ajax(url,this.ajaxSettings).always(always)}return jqXhr;function always(){decrementPendingRequests();pendingRequests[url]=null;if(that.onDeckRequestArgs){that._get.apply(that,that.onDeckRequestArgs);that.onDeckRequestArgs=null}}},get:function(query,cb){var that=this,encodedQuery=encodeURIComponent(query||""),url,resp;cb=cb||utils.noop;url=this.replace?this.replace(this.url,encodedQuery):this.url.replace(this.wildcard,encodedQuery);if(resp=requestCache.get(url)){utils.defer(function(){cb(that.filter?that.filter(resp):resp)})}else{this._get(url,cb)}return!!resp}});return Transport;function incrementPendingRequests(){pendingRequestsCount++}function decrementPendingRequests(){pendingRequestsCount--}function belowPendingRequestsThreshold(){return pendingRequestsCount<maxPendingRequests}}();var Dataset=function(){var keys={thumbprint:"thumbprint",protocol:"protocol",itemHash:"itemHash",adjacencyList:"adjacencyList"};function Dataset(o){utils.bindAll(this);if(utils.isString(o.template)&&!o.engine){$.error("no template engine specified")}if(!o.local&&!o.prefetch&&!o.remote){$.error("one of local, prefetch, or remote is required")}this.name=o.name||utils.getUniqueId();this.limit=o.limit||5;this.minLength=o.minLength||1;this.header=o.header;this.footer=o.footer;this.valueKey=o.valueKey||"value";this.template=compileTemplate(o.template,o.engine,this.valueKey);this.local=o.local;this.prefetch=o.prefetch;this.remote=o.remote;this.itemHash={};this.adjacencyList={};this.storage=o.name?new PersistentStorage(o.name):null}utils.mixin(Dataset.prototype,{_processLocalData:function(data){this._mergeProcessedData(this._processData(data))},_loadPrefetchData:function(o){var that=this,thumbprint=VERSION+(o.thumbprint||""),storedThumbprint,storedProtocol,storedItemHash,storedAdjacencyList,isExpired,deferred;if(this.storage){storedThumbprint=this.storage.get(keys.thumbprint);storedProtocol=this.storage.get(keys.protocol);storedItemHash=this.storage.get(keys.itemHash);storedAdjacencyList=this.storage.get(keys.adjacencyList)}isExpired=storedThumbprint!==thumbprint||storedProtocol!==utils.getProtocol();o=utils.isString(o)?{url:o}:o;o.ttl=utils.isNumber(o.ttl)?o.ttl:24*60*60*1e3;if(storedItemHash&&storedAdjacencyList&&!isExpired){this._mergeProcessedData({itemHash:storedItemHash,adjacencyList:storedAdjacencyList});deferred=$.Deferred().resolve()}else{deferred=$.getJSON(o.url).done(processPrefetchData)}return deferred;function processPrefetchData(data){var filteredData=o.filter?o.filter(data):data,processedData=that._processData(filteredData),itemHash=processedData.itemHash,adjacencyList=processedData.adjacencyList;if(that.storage){that.storage.set(keys.itemHash,itemHash,o.ttl);that.storage.set(keys.adjacencyList,adjacencyList,o.ttl);that.storage.set(keys.thumbprint,thumbprint,o.ttl);that.storage.set(keys.protocol,utils.getProtocol(),o.ttl)}that._mergeProcessedData(processedData)}},_transformDatum:function(datum){var value=utils.isString(datum)?datum:datum[this.valueKey],tokens=datum.tokens||utils.tokenizeText(value),item={value:value,tokens:tokens};if(utils.isString(datum)){item.datum={};item.datum[this.valueKey]=datum}else{item.datum=datum}item.tokens=utils.filter(item.tokens,function(token){return!utils.isBlankString(token)});item.tokens=utils.map(item.tokens,function(token){return token.toLowerCase()});return item},_processData:function(data){var that=this,itemHash={},adjacencyList={};utils.each(data,function(i,datum){var item=that._transformDatum(datum),id=utils.getUniqueId(item.value);itemHash[id]=item;utils.each(item.tokens,function(i,token){var character=token.charAt(0),adjacency=adjacencyList[character]||(adjacencyList[character]=[id]);!~utils.indexOf(adjacency,id)&&adjacency.push(id)})});return{itemHash:itemHash,adjacencyList:adjacencyList}},_mergeProcessedData:function(processedData){var that=this;utils.mixin(this.itemHash,processedData.itemHash);utils.each(processedData.adjacencyList,function(character,adjacency){var masterAdjacency=that.adjacencyList[character];that.adjacencyList[character]=masterAdjacency?masterAdjacency.concat(adjacency):adjacency})},_getLocalSuggestions:function(terms){var that=this,firstChars=[],lists=[],shortestList,suggestions=[];utils.each(terms,function(i,term){var firstChar=term.charAt(0);!~utils.indexOf(firstChars,firstChar)&&firstChars.push(firstChar)});utils.each(firstChars,function(i,firstChar){var list=that.adjacencyList[firstChar];if(!list){return false}lists.push(list);if(!shortestList||list.length<shortestList.length){shortestList=list}});if(lists.length<firstChars.length){return[]}utils.each(shortestList,function(i,id){var item=that.itemHash[id],isCandidate,isMatch;isCandidate=utils.every(lists,function(list){return~utils.indexOf(list,id)});isMatch=isCandidate&&utils.every(terms,function(term){return utils.some(item.tokens,function(token){return token.indexOf(term)===0})});isMatch&&suggestions.push(item)});return suggestions},initialize:function(){var deferred;this.local&&this._processLocalData(this.local);this.transport=this.remote?new Transport(this.remote):null;deferred=this.prefetch?this._loadPrefetchData(this.prefetch):$.Deferred().resolve();this.local=this.prefetch=this.remote=null;this.initialize=function(){return deferred};return deferred},getSuggestions:function(query,cb){var that=this,terms,suggestions,cacheHit=false;if(query.length<this.minLength){return}terms=utils.tokenizeQuery(query);suggestions=this._getLocalSuggestions(terms).slice(0,this.limit);if(suggestions.length<this.limit&&this.transport){cacheHit=this.transport.get(query,processRemoteData)}!cacheHit&&cb&&cb(suggestions);function processRemoteData(data){suggestions=suggestions.slice(0);utils.each(data,function(i,datum){var item=that._transformDatum(datum),isDuplicate;isDuplicate=utils.some(suggestions,function(suggestion){return item.value===suggestion.value});!isDuplicate&&suggestions.push(item);return suggestions.length<that.limit});cb&&cb(suggestions)}}});return Dataset;function compileTemplate(template,engine,valueKey){var renderFn,compiledTemplate;if(utils.isFunction(template)){renderFn=template}else if(utils.isString(template)){compiledTemplate=engine.compile(template);renderFn=utils.bind(compiledTemplate.render,compiledTemplate)}else{renderFn=function(context){return"<p>"+context[valueKey]+"</p>"}}return renderFn}}();var InputView=function(){function InputView(o){var that=this;utils.bindAll(this);this.specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};this.$hint=$(o.hint);this.$input=$(o.input).on("blur.tt",this._handleBlur).on("focus.tt",this._handleFocus).on("keydown.tt",this._handleSpecialKeyEvent);if(!utils.isMsie()){this.$input.on("input.tt",this._compareQueryToInputValue)}else{this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function($e){if(that.specialKeyCodeMap[$e.which||$e.keyCode]){return}utils.defer(that._compareQueryToInputValue)})}this.query=this.$input.val();this.$overflowHelper=buildOverflowHelper(this.$input)}utils.mixin(InputView.prototype,EventTarget,{_handleFocus:function(){this.trigger("focused")},_handleBlur:function(){this.trigger("blured")},_handleSpecialKeyEvent:function($e){var keyName=this.specialKeyCodeMap[$e.which||$e.keyCode];keyName&&this.trigger(keyName+"Keyed",$e)},_compareQueryToInputValue:function(){var inputValue=this.getInputValue(),isSameQuery=compareQueries(this.query,inputValue),isSameQueryExceptWhitespace=isSameQuery?this.query.length!==inputValue.length:false;if(isSameQueryExceptWhitespace){this.trigger("whitespaceChanged",{value:this.query})}else if(!isSameQuery){this.trigger("queryChanged",{value:this.query=inputValue})}},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(query){this.query=query},getInputValue:function(){return this.$input.val()},setInputValue:function(value,silent){this.$input.val(value);!silent&&this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(value){this.$hint.val(value)},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isOverflow:function(){this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>this.$input.width()},isCursorAtEnd:function(){var valueLength=this.$input.val().length,selectionStart=this.$input[0].selectionStart,range;if(utils.isNumber(selectionStart)){return selectionStart===valueLength}else if(document.selection){range=document.selection.createRange();range.moveStart("character",-valueLength);return valueLength===range.text.length}return true}});return InputView;function buildOverflowHelper($input){return $("<span></span>").css({position:"absolute",left:"-9999px",visibility:"hidden",whiteSpace:"nowrap",fontFamily:$input.css("font-family"),fontSize:$input.css("font-size"),fontStyle:$input.css("font-style"),fontVariant:$input.css("font-variant"),fontWeight:$input.css("font-weight"),wordSpacing:$input.css("word-spacing"),letterSpacing:$input.css("letter-spacing"),textIndent:$input.css("text-indent"),textRendering:$input.css("text-rendering"),textTransform:$input.css("text-transform")}).insertAfter($input)}function compareQueries(a,b){a=(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ");b=(b||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ");return a===b}}();var DropdownView=function(){var html={suggestionsList:'<span class="tt-suggestions"></span>'},css={suggestionsList:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"}};function DropdownView(o){utils.bindAll(this);this.isOpen=false;this.isEmpty=true;this.isMouseOverDropdown=false;this.$menu=$(o.menu).on("mouseenter.tt",this._handleMouseenter).on("mouseleave.tt",this._handleMouseleave).on("click.tt",".tt-suggestion",this._handleSelection).on("mouseover.tt",".tt-suggestion",this._handleMouseover)}utils.mixin(DropdownView.prototype,EventTarget,{_handleMouseenter:function(){this.isMouseOverDropdown=true},_handleMouseleave:function(){this.isMouseOverDropdown=false},_handleMouseover:function($e){var $suggestion=$($e.currentTarget);this._getSuggestions().removeClass("tt-is-under-cursor");$suggestion.addClass("tt-is-under-cursor")},_handleSelection:function($e){var $suggestion=$($e.currentTarget);this.trigger("suggestionSelected",extractSuggestion($suggestion))},_show:function(){this.$menu.css("display","block")},_hide:function(){this.$menu.hide()},_moveCursor:function(increment){var $suggestions,$cur,nextIndex,$underCursor;if(!this.isVisible()){return}$suggestions=this._getSuggestions();$cur=$suggestions.filter(".tt-is-under-cursor");$cur.removeClass("tt-is-under-cursor");nextIndex=$suggestions.index($cur)+increment;nextIndex=(nextIndex+1)%($suggestions.length+1)-1;if(nextIndex===-1){this.trigger("cursorRemoved");return}else if(nextIndex<-1){nextIndex=$suggestions.length-1}$underCursor=$suggestions.eq(nextIndex).addClass("tt-is-under-cursor");this._ensureVisibility($underCursor);this.trigger("cursorMoved",extractSuggestion($underCursor))},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},_ensureVisibility:function($el){var menuHeight=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),menuScrollTop=this.$menu.scrollTop(),elTop=$el.position().top,elBottom=elTop+$el.outerHeight(true);if(elTop<0){this.$menu.scrollTop(menuScrollTop+elTop)}else if(menuHeight<elBottom){this.$menu.scrollTop(menuScrollTop+(elBottom-menuHeight))}},destroy:function(){this.$menu.off(".tt");this.$menu=null},isVisible:function(){return this.isOpen&&!this.isEmpty},closeUnlessMouseIsOverDropdown:function(){if(!this.isMouseOverDropdown){this.close()}},close:function(){if(this.isOpen){this.isOpen=false;this.isMouseOverDropdown=false;this._hide();this.$menu.find(".tt-suggestions > .tt-suggestion").removeClass("tt-is-under-cursor");this.trigger("closed")}},open:function(){if(!this.isOpen){this.isOpen=true;!this.isEmpty&&this._show();this.trigger("opened")}},setLanguageDirection:function(dir){var ltrCss={left:"0",right:"auto"},rtlCss={left:"auto",right:" 0"};dir==="ltr"?this.$menu.css(ltrCss):this.$menu.css(rtlCss)
},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(+1)},getSuggestionUnderCursor:function(){var $suggestion=this._getSuggestions().filter(".tt-is-under-cursor").first();return $suggestion.length>0?extractSuggestion($suggestion):null},getFirstSuggestion:function(){var $suggestion=this._getSuggestions().first();return $suggestion.length>0?extractSuggestion($suggestion):null},renderSuggestions:function(dataset,suggestions){var datasetClassName="tt-dataset-"+dataset.name,wrapper='<div class="tt-suggestion">%body</div>',compiledHtml,$suggestionsList,$dataset=this.$menu.find("."+datasetClassName),elBuilder,fragment,$el;if($dataset.length===0){$suggestionsList=$(html.suggestionsList).css(css.suggestionsList);$dataset=$("<div></div>").addClass(datasetClassName).append(dataset.header).append($suggestionsList).append(dataset.footer).appendTo(this.$menu)}if(suggestions.length>0){this.isEmpty=false;this.isOpen&&this._show();elBuilder=document.createElement("div");fragment=document.createDocumentFragment();utils.each(suggestions,function(i,suggestion){suggestion.dataset=dataset.name;compiledHtml=dataset.template(suggestion.datum);elBuilder.innerHTML=wrapper.replace("%body",compiledHtml);$el=$(elBuilder.firstChild).css(css.suggestion).data("suggestion",suggestion);$el.children().each(function(){$(this).css(css.suggestionChild)});fragment.appendChild($el[0])});$dataset.show().find(".tt-suggestions").html(fragment)}else{this.clearSuggestions(dataset.name)}this.trigger("suggestionsRendered")},clearSuggestions:function(datasetName){var $datasets=datasetName?this.$menu.find(".tt-dataset-"+datasetName):this.$menu.find('[class^="tt-dataset-"]'),$suggestions=$datasets.find(".tt-suggestions");$datasets.hide();$suggestions.empty();if(this._getSuggestions().length===0){this.isEmpty=true;this._hide()}}});return DropdownView;function extractSuggestion($el){return $el.data("suggestion")}}();var TypeaheadView=function(){var html={wrapper:'<span class="twitter-typeahead"></span>',hint:'<input class="tt-hint" type="text" autocomplete="off" spellcheck="off" disabled>',dropdown:'<span class="tt-dropdown-menu"></span>'},css={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},query:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"}};if(utils.isMsie()){utils.mixin(css.query,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"})}if(utils.isMsie()&&utils.isMsie()<=7){utils.mixin(css.wrapper,{display:"inline",zoom:"1"});utils.mixin(css.query,{marginTop:"-1px"})}function TypeaheadView(o){var $menu,$input,$hint;utils.bindAll(this);this.$node=buildDomStructure(o.input);this.datasets=o.datasets;this.dir=null;this.eventBus=o.eventBus;$menu=this.$node.find(".tt-dropdown-menu");$input=this.$node.find(".tt-query");$hint=this.$node.find(".tt-hint");this.dropdownView=new DropdownView({menu:$menu}).on("suggestionSelected",this._handleSelection).on("cursorMoved",this._clearHint).on("cursorMoved",this._setInputValueToSuggestionUnderCursor).on("cursorRemoved",this._setInputValueToQuery).on("cursorRemoved",this._updateHint).on("suggestionsRendered",this._updateHint).on("opened",this._updateHint).on("closed",this._clearHint).on("opened closed",this._propagateEvent);this.inputView=new InputView({input:$input,hint:$hint}).on("focused",this._openDropdown).on("blured",this._closeDropdown).on("blured",this._setInputValueToQuery).on("enterKeyed tabKeyed",this._handleSelection).on("queryChanged",this._clearHint).on("queryChanged",this._clearSuggestions).on("queryChanged",this._getSuggestions).on("whitespaceChanged",this._updateHint).on("queryChanged whitespaceChanged",this._openDropdown).on("queryChanged whitespaceChanged",this._setLanguageDirection).on("escKeyed",this._closeDropdown).on("escKeyed",this._setInputValueToQuery).on("tabKeyed upKeyed downKeyed",this._managePreventDefault).on("upKeyed downKeyed",this._moveDropdownCursor).on("upKeyed downKeyed",this._openDropdown).on("tabKeyed leftKeyed rightKeyed",this._autocomplete)}utils.mixin(TypeaheadView.prototype,EventTarget,{_managePreventDefault:function(e){var $e=e.data,hint,inputValue,preventDefault=false;switch(e.type){case"tabKeyed":hint=this.inputView.getHintValue();inputValue=this.inputView.getInputValue();preventDefault=hint&&hint!==inputValue;break;case"upKeyed":case"downKeyed":preventDefault=!$e.shiftKey&&!$e.ctrlKey&&!$e.metaKey;break}preventDefault&&$e.preventDefault()},_setLanguageDirection:function(){var dir=this.inputView.getLanguageDirection();if(dir!==this.dir){this.dir=dir;this.$node.css("direction",dir);this.dropdownView.setLanguageDirection(dir)}},_updateHint:function(){var suggestion=this.dropdownView.getFirstSuggestion(),hint=suggestion?suggestion.value:null,dropdownIsVisible=this.dropdownView.isVisible(),inputHasOverflow=this.inputView.isOverflow(),inputValue,query,escapedQuery,beginsWithQuery,match;if(hint&&dropdownIsVisible&&!inputHasOverflow){inputValue=this.inputView.getInputValue();query=inputValue.replace(/\s{2,}/g," ").replace(/^\s+/g,"");escapedQuery=utils.escapeRegExChars(query);beginsWithQuery=new RegExp("^(?:"+escapedQuery+")(.*$)","i");match=beginsWithQuery.exec(hint);this.inputView.setHintValue(inputValue+(match?match[1]:""))}},_clearHint:function(){this.inputView.setHintValue("")},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(e){var suggestion=e.data;this.inputView.setInputValue(suggestion.value,true)},_openDropdown:function(){this.dropdownView.open()},_closeDropdown:function(e){this.dropdownView[e.type==="blured"?"closeUnlessMouseIsOverDropdown":"close"]()},_moveDropdownCursor:function(e){var $e=e.data;if(!$e.shiftKey&&!$e.ctrlKey&&!$e.metaKey){this.dropdownView[e.type==="upKeyed"?"moveCursorUp":"moveCursorDown"]()}},_handleSelection:function(e){var byClick=e.type==="suggestionSelected",suggestion=byClick?e.data:this.dropdownView.getSuggestionUnderCursor();if(suggestion){this.inputView.setInputValue(suggestion.value);byClick?this.inputView.focus():e.data.preventDefault();byClick&&utils.isMsie()?utils.defer(this.dropdownView.close):this.dropdownView.close();this.eventBus.trigger("selected",suggestion.datum,suggestion.dataset)}},_getSuggestions:function(){var that=this,query=this.inputView.getQuery();if(utils.isBlankString(query)){return}utils.each(this.datasets,function(i,dataset){dataset.getSuggestions(query,function(suggestions){if(query===that.inputView.getQuery()){that.dropdownView.renderSuggestions(dataset,suggestions)}})})},_autocomplete:function(e){var isCursorAtEnd,ignoreEvent,query,hint,suggestion;if(e.type==="rightKeyed"||e.type==="leftKeyed"){isCursorAtEnd=this.inputView.isCursorAtEnd();ignoreEvent=this.inputView.getLanguageDirection()==="ltr"?e.type==="leftKeyed":e.type==="rightKeyed";if(!isCursorAtEnd||ignoreEvent){return}}query=this.inputView.getQuery();hint=this.inputView.getHintValue();if(hint!==""&&query!==hint){suggestion=this.dropdownView.getFirstSuggestion();this.inputView.setInputValue(suggestion.value);this.eventBus.trigger("autocompleted",suggestion.datum,suggestion.dataset)}},_propagateEvent:function(e){this.eventBus.trigger(e.type)},destroy:function(){this.inputView.destroy();this.dropdownView.destroy();destroyDomStructure(this.$node);this.$node=null},setQuery:function(query){this.inputView.setQuery(query);this.inputView.setInputValue(query);this._clearHint();this._clearSuggestions();this._getSuggestions()}});return TypeaheadView;function buildDomStructure(input){var $wrapper=$(html.wrapper),$dropdown=$(html.dropdown),$input=$(input),$hint=$(html.hint);$wrapper=$wrapper.css(css.wrapper);$dropdown=$dropdown.css(css.dropdown);$hint.css(css.hint).css({backgroundAttachment:$input.css("background-attachment"),backgroundClip:$input.css("background-clip"),backgroundColor:$input.css("background-color"),backgroundImage:$input.css("background-image"),backgroundOrigin:$input.css("background-origin"),backgroundPosition:$input.css("background-position"),backgroundRepeat:$input.css("background-repeat"),backgroundSize:$input.css("background-size")});$input.data("ttAttrs",{dir:$input.attr("dir"),autocomplete:$input.attr("autocomplete"),spellcheck:$input.attr("spellcheck"),style:$input.attr("style")});$input.addClass("tt-query").attr({autocomplete:"off",spellcheck:false}).css(css.query);try{!$input.attr("dir")&&$input.attr("dir","auto")}catch(e){}return $input.wrap($wrapper).parent().prepend($hint).append($dropdown)}function destroyDomStructure($node){var $input=$node.find(".tt-query");utils.each($input.data("ttAttrs"),function(key,val){utils.isUndefined(val)?$input.removeAttr(key):$input.attr(key,val)});$input.detach().removeData("ttAttrs").removeClass("tt-query").insertAfter($node);$node.remove()}}();(function(){var cache={},viewKey="ttView",methods;methods={initialize:function(datasetDefs){var datasets;datasetDefs=utils.isArray(datasetDefs)?datasetDefs:[datasetDefs];if(datasetDefs.length===0){$.error("no datasets provided")}datasets=utils.map(datasetDefs,function(o){var dataset=cache[o.name]?cache[o.name]:new Dataset(o);if(o.name){cache[o.name]=dataset}return dataset});return this.each(initialize);function initialize(){var $input=$(this),deferreds,eventBus=new EventBus({el:$input});deferreds=utils.map(datasets,function(dataset){return dataset.initialize()});$input.data(viewKey,new TypeaheadView({input:$input,eventBus:eventBus=new EventBus({el:$input}),datasets:datasets}));$.when.apply($,deferreds).always(function(){utils.defer(function(){eventBus.trigger("initialized")})})}},destroy:function(){return this.each(destroy);function destroy(){var $this=$(this),view=$this.data(viewKey);if(view){view.destroy();$this.removeData(viewKey)}}},setQuery:function(query){return this.each(setQuery);function setQuery(){var view=$(this).data(viewKey);view&&view.setQuery(query)}}};jQuery.fn.typeahead=function(method){if(methods[method]){return methods[method].apply(this,[].slice.call(arguments,1))}else{return methods.initialize.apply(this,arguments)}}})()})(window.jQuery);jQuery.cookie=function(name,value,options){if(typeof value!="undefined"){options=options||{};if(value===null){value="";options.expires=-1}var expires="";if(options.expires&&(typeof options.expires=="number"||options.expires.toUTCString)){var date;if(typeof options.expires=="number"){date=new Date;date.setTime(date.getTime()+options.expires*24*60*60*1e3)}else{date=options.expires}expires="; expires="+date.toUTCString()}var path=options.path?"; path="+options.path:"";var domain=options.domain?"; domain="+options.domain:"";var secure=options.secure?"; secure":"";document.cookie=[name,"=",encodeURIComponent(value),expires,path,domain,secure].join("")}else{var cookieValue=null;if(document.cookie&&document.cookie!=""){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}}return cookieValue}};(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.5.1";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return}}else{for(var key in obj){if(_.has(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return}}}};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))});return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else{memo=iterator.call(context,memo,value,index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator)}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true}else{memo=iterator.call(context,memo,obj[index],index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results.push(value)});return results};_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list)},context)};_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker});return!!result};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker});return!!result};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target})};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})};_.where=function(obj,attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return _[first?"find":"filter"](obj,function(value){for(var key in attrs){if(attrs[key]!==value[key])return false}return true})};_.findWhere=function(obj,attrs){return _.where(obj,attrs,true)};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj)}if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity,value:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>result.computed&&(result={value:value,computed:computed})});return result.value};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj)}if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity,value:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})});return result.value};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value});return shuffled};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value]}};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index<right.index?-1:1}),"value")};var group=function(obj,value,context,behavior){var result={};var iterator=lookupIterator(value==null?_.identity:value);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)});return result};_.groupBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){(_.has(result,key)?result[key]:result[key]=[]).push(value)})};_.countBy=function(obj,value,context){return group(obj,value,context,function(result,key){if(!_.has(result,key))result[key]=0;result[key]++})};_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;return n!=null&&!guard?slice.call(array,0,n):array[0]};_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))};_.last=function(array,n,guard){if(array==null)return void 0;if(n!=null&&!guard){return slice.call(array,Math.max(array.length-n,0))}else{return array[array.length-1]}};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input)}each(input,function(value){if(_.isArray(value)||_.isArguments(value)){shallow?push.apply(output,value):flatten(value,shallow,output)}else{output.push(value)}});return output};_.flatten=function(array,shallow){return flatten(array,shallow,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};_.union=function(){return _.uniq(_.flatten(arguments,true))};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){var length=_.max(_.pluck(arguments,"length").concat(0));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,""+i)}return results};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,l=list.length;i<l;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,l=array.length;if(isSorted){if(typeof isSorted=="number"){i=isSorted<0?Math.max(0,l+isSorted):isSorted}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<l;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item)}var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step}return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self}};_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)))}};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)throw new Error("bindAll must be passed function names");each(funcs,function(f){obj[f]=_.bind(obj[f],obj)});return obj};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;options||(options={});var later=function(){previous=options.leading===false?0:new Date;timeout=null;result=func.apply(context,args)};return function(){var now=new Date;if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var result;var timeout=null;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)result=func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)result=func.apply(context,args);return result}};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}};_.wrap=function(func,wrapper){return function(){var args=[func];push.apply(args,arguments);return wrapper.apply(this,args)}};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)]}return args[0]}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys};_.values=function(obj){var values=[];for(var key in obj)if(_.has(obj,key))values.push(obj[key]);return values};_.pairs=function(obj){var pairs=[];for(var key in obj)if(_.has(obj,key))pairs.push([key,obj[key]]);return pairs};_.invert=function(obj){var result={};for(var key in obj)if(_.has(obj,key))result[obj[key]]=key;return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key]});return copy};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key]}return copy};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop]}}});return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b}var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)){return false}aStack.push(a);bStack.push(b);var size=0,result=true;if(className=="[object Array]"){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break}}}else{for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}}if(result){for(key in b){if(_.has(b,key)&&!size--)break}result=!size}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"};_.isObject=function(obj){return obj===Object(obj)};each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,"callee"))}}if(typeof/./!=="function"){_.isFunction=function(obj){return typeof obj==="function"}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){if(string==null)return"";return(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}});_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}if(evaluate){source+="';\n"+evaluate+"\n__p+='"}index=offset+match.length;return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};template.source="function("+(settings.variable||"obj")+"){\n"+source+"}";return template};_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_);each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=="shift"||name=="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.extend(_.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=="undefined"){Backbone=exports}else{Backbone=root.Backbone={}}Backbone.VERSION="1.0.0";var _=root._;if(!_&&typeof require!=="undefined")_=require("underscore");Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;
Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments)});once._callback=callback;return this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this}names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context){retain.push(ev)}}}if(!retain.length)delete this._events[name]}}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this},stopListening:function(obj,name,callback){var listeners=this._listeners;if(!listeners)return this;var deleteListener=!name&&!callback;if(typeof name==="object")callback=this;if(obj)(listeners={})[obj._listenerId]=obj;for(var id in listeners){listeners[id].off(name,callback,this);if(deleteListener)delete this._listeners[id]}return this}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==="object"){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest))}return false}if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest))}return false}return true};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args)}};var listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeners=this._listeners||(this._listeners={});var id=obj._listenerId||(obj._listenerId=_.uniqueId("l"));listeners[id]=obj;if(typeof name==="object")callback=this;obj[implementation](name,callback,this);return this}});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var defaults;var attrs=attributes||{};options||(options={});this.cid=_.uniqueId("c");this.attributes={};_.extend(this,_.pick(options,modelOptions));if(options.parse)attrs=this.parse(attrs,options)||{};if(defaults=_.result(this,"defaults")){attrs=_.defaults({},attrs,defaults)}this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};var modelOptions=["url","urlRoot","collection"];_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return this.get(attr)!=null},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val}else{delete this.changed[attr]}unset?delete current[attr]:current[attr]=val}if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger("change:"+changes[i],this,current[changes[i]],options)}}if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger("change",this,options)}}this._pending=false;this._changing=false;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}))},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);return this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}if(attrs&&(!options||!options.wait)&&!this.set(attrs,options))return false;options=_.extend({validate:true},options);if(!this._validate(attrs,options))return false;if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs)}if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false}if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);method=this.isNew()?"create":options.patch?"patch":"update";if(method==="patch")options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger("destroy",model,model.collection,options)};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger("sync",model,resp,options)};if(this.isNew()){options.success();return false}wrapError(this,options);var xhr=this.sync("delete",this,options);if(!options.wait)destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger("invalid",this,error,_.extend(options||{},{validationError:error}));return false}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.url)this.url=options.url;if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options))};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,merge:false,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.defaults(options||{},addOptions))},remove:function(models,options){models=_.isArray(models)?models.slice():[models];options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model)}return this},set:function(models,options){options=_.defaults(options||{},setOptions);if(options.parse)models=this.parse(models,options);if(!_.isArray(models))models=models?[models]:[];var i,l,model,attrs,existing,sort;var at=options.at;var sortable=this.comparator&&at==null&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};for(i=0,l=models.length;i<l;i++){if(!(model=this._prepareModel(models[i],options)))continue;if(existing=this.get(model)){if(options.remove)modelMap[existing.cid]=true;if(options.merge){existing.set(model.attributes,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true}}else if(options.add){toAdd.push(model);model.on("all",this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model}}if(options.remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model)}if(toRemove.length)this.remove(toRemove,options)}if(toAdd.length){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){splice.apply(this.models,[at,0].concat(toAdd))}else{push.apply(this.models,toAdd)}}if(sort)this.sort({silent:true});if(options.silent)return this;for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger("add",model,this,options)}if(sort)this.trigger("sort",this,options);return this},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i])}options.previousModels=this.models;this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return this},push:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:this.length},options));return model},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model},shift:function(options){var model=this.at(0);this.remove(model,options);return model},slice:function(begin,end){return this.models.slice(begin,end)},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id!=null?obj.id:obj.cid||obj]},at:function(index){return this.models[index]},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?"find":"filter"](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false}return true})},findWhere:function(attrs){return this.where(attrs,true)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(_.bind(this.comparator,this))}if(!options.silent)this.trigger("sort",this,options);return this},sortedIndex:function(model,value,context){value||(value=this.comparator);var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _.sortedIndex(this.models,model,iterator,context)},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger("sync",collection,resp,options)};wrapError(this,options);return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(resp){if(options.wait)collection.add(model,options);if(success)success(model,resp,options)};model.save(null,options);return model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs}options||(options={});options.collection=this;var model=new this.model(attrs,options);if(!model._validate(attrs,options)){this.trigger("invalid",this,attrs,options);return false}return model},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event==="add"||event==="remove")&&collection!==this)return;if(event==="destroy")this.remove(model,options);if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model}this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this},delegateEvents:function(events){if(!(events||(events=_.result(this,"events"))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===""){this.$el.on(eventName,method)}else{this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(options){if(this.options)options=_.extend({},_.result(this,"options"),options);_.extend(this,_.pick(options,viewOptions));this.options=options},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,"attributes"));if(this.id)attrs.id=_.result(this,"id");if(this.className)attrs["class"]=_.result(this,"className");var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,false)}else{this.setElement(_.result(this,"el"),false)}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(!options.url){params.url=_.result(model,"url")||urlError()}if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){params.type="POST";if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);if(beforeSend)return beforeSend.apply(this,arguments)}}if(params.type!=="GET"&&!options.emulateJSON){params.processData=false}if(params.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};var methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name=""}if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,["route:"+name].concat(args));router.trigger("route",name,args);Backbone.history.trigger("route",router,name,args)});return this},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,"routes");var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/]+)"}).replace(splatParam,"(.*?)");return new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,"");if(!fragment.indexOf(root))fragment=fragment.substr(root.length)}else{fragment=this.getHash()}}return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);this.root=("/"+this.root+"/").replace(rootStripper,"/");if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState){Backbone.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!oldIE){Backbone.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");this.history.replaceState({},document.title,this.root+this.fragment+loc.search)}if(!this.options.silent)return this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe))}if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}});return matched},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};fragment=this.getFragment(fragment||"");if(this.fragment===fragment)return;this.fragment=fragment;var url=this.root+fragment;if(this._hasPushState){this.history[options.replace?"replaceState":"pushState"]({},document.title,url)}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace)}}else{return this.location.assign(url)}if(options.trigger)this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else{location.hash="#"+fragment}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger("error",model,resp,options)}}}).call(this);window.JST=window.JST||{};window.JST["beaker-typeaheads/group-name"]=_.template("<p><%- group_name %> <small><%- display_name %></small></p>\n");window.JST["beaker-typeaheads/user-name"]=_.template("<p><%- user_name %> <small><%- display_name %></small></p>\n");window.JST["access-policy"]=_.template('<form>\n<table class="table table-bordered table-hover">\n  <thead>\n    <tr>\n      <th></th>\n      <% _.each(possible_permissions, function (permission) { %>\n        <th><%- permission.label %></th>\n      <% }); %>\n    </tr>\n  </thead>\n  <tbody class="group-rows">\n    <tr>\n      <th colspan="<%- possible_permissions.length + 1 %>">Group</th>\n    </tr>\n    <!-- group rows go here -->\n    <% if (!readonly) { %>\n      <tr>\n        <td>\n          <input type="text" placeholder="Group name" />\n        </td>\n        <td colspan="<%- possible_permissions.length %>"></td>\n      </tr>\n    <% } %>\n  </tbody>\n  <tbody class="user-rows">\n    <tr>\n      <th colspan="<%- possible_permissions.length + 1 %>">User</th>\n    </tr>\n    <!-- user rows go here -->\n    <% if (!readonly) { %>\n      <tr>\n        <td><input type="text" placeholder="Username" /></td>\n        <td colspan="<%- possible_permissions.length %>"></td>\n      </tr>\n    <% } %>\n  </tbody>\n  <tbody class="everybody-row">\n    <!-- everybody row goes here -->\n  </tbody>\n</table>\n<% if (!readonly) { %>\n  <div class="form-actions">\n    <button type="submit" class="btn btn-primary">Save changes</button>\n    <button type="reset" class="btn">Revert</button>\n    <span class="sync-status"></span>\n  </div>\n<% } %>\n</form>\n');(function($){var pad=function(n){return n<10?"0"+n:n};var offset_hours=function(d){var offset_mins=d.getTimezoneOffset();if(offset_mins==0)return"+00:00";return(offset_mins>0?"-":"+")+pad(Math.abs(offset_mins)/60)+":"+pad(Math.abs(offset_mins)%60)};var iso8601=function(d){return d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate())+" "+pad(d.getHours())+":"+pad(d.getMinutes())+":"+pad(d.getSeconds())+" "+offset_hours(d)};$.fn.localDatetime=function(){this.each(function(i,elem){if(elem._localDatetime_done)return;elem._localDatetime_done=true;try{var d=new Date(elem.textContent.replace(/-/g,"/")+" +00:00");if(isNaN(d.getTime()))return;elem.textContent=iso8601(d)}catch(e){if(typeof console!="undefined"&&typeof console.log!="undefined"){console.log(e)}}})};$(document).ready(function(){$(".datetime").localDatetime()});$.each(["append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html"],function(i,method){var decorated=$.fn[method];$.fn[method]=function(){var retval=decorated.apply(this,arguments);$(".datetime").localDatetime();return retval}})})(jQuery);(function(){window.link_tabs_to_anchor=function(){$(".nav-tabs a").on("shown",function(e){window.history.replaceState(undefined,undefined,$(this).attr("href"));$.cookie("beaker_system_tab",$(this).attr("href"))});var open_tab=function(href){$('.nav-tabs a[href="'+href+'"]').tab("show")};$(window).on("hashchange",function(){open_tab(location.hash);return false});if(location.hash){open_tab(location.hash)}else if($.cookie("beaker_system_tab")){var href=$.cookie("beaker_system_tab");window.history.replaceState(undefined,undefined,href);open_tab(href)}else{$(".nav-tabs a:first").tab("show")}}})();(function($){var results_filter=function(response){return response.data};$.fn.beaker_typeahead=function(type){var options={"group-name":{name:"beaker-group-name",prefetch:{url:"/groups/+typeahead",filter:results_filter},valueKey:"group_name",limit:8,template:JST["beaker-typeaheads/group-name"]},"user-name":{name:"beaker-user-name",prefetch:{url:"/users/+typeahead",filter:results_filter},remote:{url:"/users/+typeahead?q=%QUERY",filter:results_filter},valueKey:"user_name",limit:10,template:JST["beaker-typeaheads/user-name"]}}[type];this.typeahead(options);this.data("typeahead_match",false);this.on("typeahead:selected typeahead:autocompleted",function(){$(this).data("typeahead_match",true)});this.on("change",function(evt){var $input=$(this);var available=$input.data("ttView").datasets[0].itemHash;var matching=_.findWhere(available,{value:$input.val()});$input.data("typeahead_match",!!matching)});return this}})(jQuery);(function(){window.RecipeTasksView=Backbone.View.extend({events:{"show .results-tabs a":"set_cookie"},initialize:function(){this.$(".failed-tab").one("show",_.bind(this.load_failed,this));if(window.location.hash){this.load_results().then(_.bind(this.activate_tab,this))}else{this.$(".results-tab").one("show",_.bind(this.load_results,this));this.activate_tab()}},activate_tab:function(){var cookie_value=$.cookie("recipe_"+this.options.recipe_id);if(window.location.hash&&this.$(".results-pane "+window.location.hash).length){this.$(".results-tab").tab("show").addClass("active");window.location.hash=window.location.hash}else if(cookie_value){this.$(".results-tabs a").filter(function(){return $(this).data("cookieValue")==cookie_value}).tab("show").addClass("active")}else{this.$(".hide-results-tab").tab("show").addClass("active")}},load_results:function(){var $pane=this.$(".results-pane");$pane.html('<i class="icon-spinner icon-spin"></i> Loading&hellip;');return $.ajax({url:"../tasks/do_search?tasks_tgp_order=id&tasks_tgp_limit=0&recipe_id="+this.options.recipe_id,dataType:"html",success:function(data){$pane.html(data)},error:function(jqxhr,status,error){$pane.addClass("alert alert-error").text(error)}})},load_failed:function(){var $pane=this.$(".failed-pane");$pane.html('<i class="icon-spinner icon-spin"></i> Loading&hellip;');return $.ajax({url:"../tasks/do_search?tasks_tgp_order=id&tasks_tgp_limit=0&is_failed=1&recipe_id="+this.options.recipe_id,dataType:"html",success:function(data){$pane.html(data)},error:function(jqxhr,status,error){$pane.addClass("alert alert-error").text(error)}})},set_cookie:function(evt){var new_cookie_value=$(evt.target).data("cookieValue");$.cookie("recipe_"+this.options.recipe_id,new_cookie_value)}})})();(function(){var AccessPolicyRule=Backbone.Model.extend({initialize:function(attributes,options){if(!_.has(attributes,"everybody")){this.set("everybody",attributes["user"]==null&&attributes["group"]==null)}}});window.AccessPolicy=Backbone.Model.extend({initialize:function(){this.rules=new Backbone.Collection([],{model:AccessPolicyRule})},parse:function(response){if(_.isUndefined(response))return;this.rules.reset(response.rules);return{id:response.id,possible_permissions:response.possible_permissions}
},toJSON:function(){return{rules:this.rules.toJSON()}}});var blur_on_enter=function(evt){if(evt.which==13){$(evt.target).trigger("blur");return false}};window.AccessPolicyView=Backbone.View.extend({template:JST["access-policy"],events:{"change   input[type=checkbox]":"changed_checkbox","keypress .group-rows input[type=text]":blur_on_enter,"blur     .group-rows input[type=text]":"typed_group","typeahead:selected      .group-rows input[type=text]":"typed_group","typeahead:autocompleted .group-rows input[type=text]":"typed_group","keypress .user-rows input[type=text]":blur_on_enter,"blur     .user-rows input[type=text]":"typed_user","typeahead:selected      .user-rows input[type=text]":"typed_user","typeahead:autocompleted .user-rows input[type=text]":"typed_user","submit   form":"submit","reset    form":"reset"},initialize:function(){this.dirty=false;this.request_in_progress=false;this.listenTo(this.model,"request",this.sync_started);this.listenTo(this.model,"sync",this.sync_complete);this.listenTo(this.model,"error",this.sync_error);this.listenTo(this.model,"change:possible_permissions",this.render);this.listenTo(this.model.rules,"reset",this.render);this.listenTo(this.model.rules,"add",function(rule){this.find_checkbox_for_rule(rule).checked=true});this.listenTo(this.model.rules,"remove",function(rule){this.find_checkbox_for_rule(rule).checked=false});this.render()},render:function(){this.$el.html(this.template(_.extend({readonly:this.options.readonly},this.model.attributes)));_.chain(this.model.rules.pluck("group")).compact().uniq().each(this.add_group_row,this);_.chain(this.model.rules.pluck("user")).compact().uniq().each(this.add_user_row,this);this.add_everybody_row();this.model.rules.each(function(rule){this.find_checkbox_for_rule(rule).checked=true},this);if(this.options.readonly){this.$("input[type=checkbox]").prop("disabled",true)}this.$(".group-rows input[type=text]").beaker_typeahead("group-name");this.$(".user-rows input[type=text]").beaker_typeahead("user-name")},update_button_state:function(){this.$("button").prop("disabled",!this.dirty||this.request_in_progress)},sync_started:function(){this.request_in_progress=true;this.update_button_state()},sync_complete:function(){this.dirty=false;this.request_in_progress=false;this.update_button_state();this.$(".dirty").removeClass("dirty");this.$(".sync-status").empty()},sync_error:function(model,xhr){this.request_in_progress=false;this.update_button_state();this.$(".sync-status").empty().append($('<span class="alert alert-error"/>').text("Server request failed: "+xhr.statusText))},submit:function(){if(this.request_in_progress)return false;this.$(".sync-status").html('<i class="icon-spinner icon-spin"></i> Saving&hellip;');this.model.save();return false},reset:function(){if(this.request_in_progress)return false;this.$(".sync-status").html('<i class="icon-spinner icon-spin"></i> Loading&hellip;');this.model.fetch();return false},typed_group:function(evt){var $input=$(evt.target);var val=$input.val();if(val&&$input.data("typeahead_match")){var $row=this.find_group_row(val);if(!$row.length){var $row=this.add_group_row(val)}$row.find("input[type=checkbox]").first().focus();$input.typeahead("setQuery","")}},typed_user:function(evt){var $input=$(evt.target);var val=$input.val();if(val&&$input.data("typeahead_match")){var $row=this.find_user_row(val);if(!$row.length){var $row=this.add_user_row(val)}$row.find("input[type=checkbox]").first().focus();$input.typeahead("setQuery","")}},find_group_row:function(group){return $(".group-rows tr").filter(function(){return $.data(this,"group")==group})},add_group_row:function(group){var row=$("<tr/>");row.data("group",group);$("<td/>").text(group).appendTo(row);_.each(this.model.get("possible_permissions"),function(permission){var checkbox=$('<input type="checkbox"/>').data("user",null).data("group",group).data("permission",permission.value);$("<td/>").append(checkbox).appendTo(row)},this);if(this.options.readonly)this.$(".group-rows").append(row);else this.$(".group-rows tr:last").before(row);return row},find_user_row:function(user){return $(".user-rows tr").filter(function(){return $.data(this,"user")==user})},add_user_row:function(user){var row=$("<tr/>");row.data("user",user);$("<td/>").text(user).appendTo(row);_.each(this.model.get("possible_permissions"),function(permission){var checkbox=$('<input type="checkbox"/>').data("user",user).data("group",null).data("permission",permission.value);$("<td/>").append(checkbox).appendTo(row)},this);if(this.options.readonly)this.$(".user-rows").append(row);else this.$(".user-rows tr:last").before(row);return row},add_everybody_row:function(){var row=$("<tr/>");$("<th/>").text("Everybody").appendTo(row);_.each(this.model.get("possible_permissions"),function(permission){var checkbox=$('<input type="checkbox"/>').data("user",null).data("group",null).data("permission",permission.value);$("<td/>").append(checkbox).appendTo(row)},this);this.$(".everybody-row").append(row);return row},find_checkbox_for_rule:function(rule){return this.$("input[type=checkbox]").filter(function(){return $.data(this,"permission")==rule.get("permission")&&$.data(this,"group")==rule.get("group")&&$.data(this,"user")==rule.get("user")}).get(0)},changed_checkbox:function(evt){var $elem=$(evt.target);var user=$elem.data("user");var group=$elem.data("group");var rule_attrs={permission:$elem.data("permission"),group:group,user:user};if(evt.target.checked){this.model.rules.add(rule_attrs)}else{var rule=this.model.rules.findWhere(rule_attrs);this.model.rules.remove(rule)}if(user){this.find_user_row(user).addClass("dirty")}else if(group){this.find_group_row(group).addClass("dirty")}else{this.$(".everybody-row tr").addClass("dirty")}this.dirty=true;this.update_button_state()}})})();